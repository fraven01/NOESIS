{% load recording_extras %}
<div class="overflow-x-auto">
<table id="knowledge-table" class="mb-4 w-full text-left">
    <thead>
        <tr class="bg-background dark:bg-background-dark">
            <th class="px-2 py-1 bg-background dark:bg-background-dark">Software</th>
            <th class="px-2 py-1 text-center bg-background dark:bg-background-dark">Bekannt?</th>
            <th class="px-2 py-1 bg-background dark:bg-background-dark">Beschreibung</th>
            <th class="px-2 py-1 text-center bg-background dark:bg-background-dark">Aktionen</th>
        </tr>
    </thead>
    <tbody>
    {% for row in knowledge_rows %}
        <tr class="border-t" data-id="{{ row.entry.id|default:'' }}">
            <td class="px-2 py-1">{{ row.name }}</td>
            <td class="px-2 py-1 text-center">
                {% if row.entry and row.entry.is_known_by_llm is True %}
                    {% include 'partials/status_badge.html' with status_key='ja' label='✓ Bekannt' %}
                {% elif row.entry and row.entry.is_known_by_llm is False %}
                    {% include 'partials/status_badge.html' with status_key='nein' label='✗ Nicht bekannt' %}
                {% else %}
                    {% include 'partials/status_badge.html' with status_key='unbekannt' label='? Ungeprüft' %}
                {% endif %}
            </td>
            <td class="px-2 py-1">
                {% if row.entry and row.entry.is_known_by_llm is True %}
                    <div class="prose max-w-none">
                        {{ row.entry.description|markdownify }}
                    </div>
                {% elif row.entry and row.entry.is_known_by_llm is False %}
                    <p class="text-sm text-gray-500 dark:text-gray-400">Die automatische Prüfung konnte diese Software nicht eindeutig identifizieren.</p>
                {% else %}
                {% endif %}
            </td>
            <td class="px-2 py-1 text-center space-x-2">
            {% if row.entry and row.entry.is_known_by_llm is True %}
                {% url 'edit_knowledge_description' row.entry.id as edit_url %}
                {% url 'download_knowledge_as_word' row.entry.id as export_url %}
                {% url 'delete_knowledge_entry' row.entry.id as delete_url %}
                {% include 'partials/_button.html' with href=edit_url label='Bearbeiten' variant='primary' classes='text-sm px-2 py-1' %}
                {% include 'partials/_button.html' with href=export_url label='Export' variant='primary' classes='text-sm px-2 py-1' %}
                {% include 'partials/_button.html' with href=delete_url label='Löschen' variant='danger' classes='text-sm px-2 py-1' %}
            {% elif row.entry and row.entry.is_known_by_llm is False %}
                {% include 'partials/_button.html' with type='button' label='Erneut prüfen' variant='primary' classes='text-sm px-2 py-1 retry-check-btn' attrs='data-knowledge-id="'|add:row.entry.id|add:'"' %}
            {% else %}
                {% include 'partials/_button.html' with type='button' label='Prüfung starten' variant='primary' classes='text-sm px-2 py-1 start-initial-check-btn' attrs='data-knowledge-id="'|add:row.entry.id|add:'"' %}
            {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>
{% include 'partials/_button.html' with id='start-checks' label='Prüfung starten' variant='success' classes='text-background' %}
