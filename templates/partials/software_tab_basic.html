{% load recording_extras %}
<div class="space-y-4">
    {% for row in knowledge_rows %}
        <div class="card p-4" data-id="{{ row.entry.id|default:'' }}">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h3 class="font-semibold">{{ row.name }}</h3>
                    <div>
                        {% if row.entry and row.entry.is_known_by_llm is True %}
                            {% include 'partials/status_badge.html' with status_key='ja' label='✓ Bekannt' %}
                        {% elif row.entry and row.entry.is_known_by_llm is False %}
                            {% include 'partials/status_badge.html' with status_key='nein' label='✗ Nicht bekannt' %}
                        {% else %}
                            {% include 'partials/status_badge.html' with status_key='unbekannt' label='? Ungeprüft' %}
                        {% endif %}
                    </div>
                </div>
                <div class="space-x-2">
                    {% if row.entry and row.entry.is_known_by_llm is True %}
                        <a href="{% url 'edit_knowledge_description' row.entry.id %}" class="btn btn-primary btn-sm">Bearbeiten</a>
                        <a href="{% url 'download_knowledge_as_word' row.entry.id %}" class="btn btn-secondary btn-sm">Export</a>
                        {% if is_admin or has_project_access %}
                            <form method="post" action="{% url 'delete_knowledge_entry' row.entry.id %}" class="inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-error btn-sm" onclick="return confirm('Eintrag wirklich löschen?');">Löschen</button>
                            </form>
                        {% endif %}
                    {% elif row.entry and row.entry.is_known_by_llm is False %}
                        <button type="button" class="btn btn-warning btn-sm retry-check-btn" data-knowledge-id="{{ row.entry.id }}">Erneut prüfen</button>
                    {% else %}
                        <button type="button" class="btn btn-primary btn-sm start-initial-check-btn" data-knowledge-id="{{ row.entry.id|default:'' }}">Prüfung starten</button>
                    {% endif %}
                </div>
            </div>
            <div>
                {% if row.entry and row.entry.is_known_by_llm is True %}
                    <div class="prose dark:prose-invert max-w-none">
                        {{ row.entry.description|markdownify }}
                    </div>
                {% elif row.entry and row.entry.is_known_by_llm is False %}
                    <p class="text-sm text-muted">Die automatische Prüfung konnte diese Software nicht eindeutig identifizieren.</p>
                {% else %}
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>
<button id="start-checks" type="button" class="bg-success text-background px-4 py-2 rounded">Prüfung starten</button>

