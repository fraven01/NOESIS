{% load recording_extras ui_extras %}
<tr class="{% if row.sub %}subquestion-row hidden subquestions-for-{{ row.func_id }} {% endif %}{% if row.is_negotiable %}opacity-80{% endif %}"
    data-relevant="{{ row.doc_result|get_item:'technisch_vorhanden'|yesno:'true,false,unknown' }}"
    data-parsed-status="{{ row.doc_result|get_item:'technisch_vorhanden'|yesno:'True,False,None' }}"
    data-parsed-notes="{{ row.doc_result|raw_item:'technisch_vorhanden'|get_item:'note' }}"
    data-ai='{{ row.ai_result|tojson }}'
    data-doc='{{ row.doc_result|tojson }}'
    data-manual='{{ row.manual_result|tojson }}'
    data-negotiable="{{ row.is_negotiable|yesno:'true,false' }}"
    data-manual-override="{{ row.negotiable_manual_override|yesno:'true,false,' }}"
    data-requires-review="{{ row.requires_manual_review|yesno:'true,false' }}"
    data-func-id="{{ row.func_id }}" {% if row.sub %}data-sub-id="{{ row.sub_id }}"{% endif %}>
    <td class="border px-2 {% if row.sub %}pl-8{% endif %}">
        {% if not row.sub %}
        <button class="toggle-button mr-2 inline-flex items-center justify-center px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded {% btn_classes 'muted' %}" type="button" data-target-class="subquestions-for-{{ row.func_id }}">+</button>
        {{ row.name }}
        {% if row.has_justification %}
        <a href="{% url 'justification_detail_edit' anlage.pk row.verif_key %}" class="ml-2 inline-flex items-center px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded text-muted {% btn_classes 'muted' %}">Begr√ºndung ansehen/bearbeiten</a>
        {% endif %}
        {% else %}
        {{ row.name }}
        {% if row.has_justification %}
        <a href="{% url 'justification_detail_edit' anlage.pk row.verif_key %}" class="ml-2 inline-flex items-center px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded text-muted {% btn_classes 'muted' %}">Begr√ºndung ansehen/bearbeiten</a>
        {% endif %}
        {% endif %}
    </td>
    {% for field in fields %}
    {% with f=row.form_fields|get_item:field %}
    {% include 'partials/review_cell.html' with row=row field_name=field state=row.initial|get_item:field source=f.source is_manual=row.manual_flags|get_item:field widget=f.widget %}
    {% endwith %}
    {% endfor %}
    {% include 'partials/negotiable_cell.html' with row=row is_negotiable=row.is_negotiable override=row.negotiable_manual_override %}
    <td class="border px-2 text-center action-column">
        <button type="button" class="review-cycle-btn inline-flex items-center justify-center px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded {% btn_classes 'muted' %}"
            data-state="robot" title="KI-Pr√ºfung starten"
            data-project-file-id="{{ anlage.pk }}"
            data-function-id="{{ row.func_id }}"
            data-justification-url="{% url 'justification_detail_edit' anlage.pk row.verif_key %}"
            {% if row.sub %}data-subquestion-id="{{ row.sub_id }}"{% endif %}>ü§ñ</button>
    </td>
</tr>
