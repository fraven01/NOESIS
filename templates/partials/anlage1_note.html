{% load recording_extras %}
<div id="note-{{ field }}-{{ num }}">
{% if editing %}
  <form hx-post="{% url 'hx_anlage1_note' anlage.pk num field %}"
        hx-target="#note-{{ field }}-{{ num }}" hx-swap="outerHTML" class="space-y-2">
    <textarea name="text" rows="3" class="w-full border rounded p-2">{{ text }}</textarea>
    <div class="space-x-2">
      {% include 'partials/_button.html' with type='submit' label='Speichern' variant='primary' classes='px-2 py-1' %}
      {% url 'hx_anlage1_note' anlage.pk num field as cancel_url %}
      {% include 'partials/_button.html' with type='button' label='Abbrechen' variant='secondary' classes='px-2 py-1' attrs='hx-get="'|add:cancel_url|add:'" hx-target="#note-'|add:field|add:'-'|add:num|add:'" hx-swap="outerHTML"' %}
    </div>
  </form>
{% else %}
  <div class="prose max-w-none">{{ text|markdownify }}</div>
  <button type="button" class="mt-1 bg-gray-200 px-2 py-1 rounded"
          hx-get="{% url 'hx_anlage1_note' anlage.pk num field %}?edit=1"
          hx-target="#note-{{ field }}-{{ num }}" hx-swap="outerHTML">Bearbeiten</button>
{% endif %}
</div>
