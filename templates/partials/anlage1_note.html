{% load recording_extras %}
<div id="note-{{ field }}-{{ num }}">
{% if editing %}
  {% with num|stringformat:"s" as num_str %}
    <form hx-post="{% url 'hx_anlage1_note' anlage.pk num field %}"
          hx-target="#note-{{ field }}-{{ num_str }}" hx-swap="outerHTML" class="space-y-2">
      {% url 'hx_anlage1_note' anlage.pk num field as abbrechen_url %}
        <textarea name="text" rows="3" class="w-full border-gray-300 dark:border-gray-600 bg-background dark:bg-background-dark text-gray-900 dark:text-gray-100 rounded p-2 focus:border-primary dark:focus:border-primary focus:ring-primary dark:focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">{{ text }}</textarea>
      <div class="space-x-2">
        {% include 'partials/_button.html' with type='submit' label='Speichern' variant='primary' classes='px-2 py-1 rounded' %}
        {% with 'hx-get="'|add:abbrechen_url|add:'"'|add:' hx-target="#note-'|add:field|add:'-'|add:num_str|add:'"'|add:' hx-swap="outerHTML"' as cancel_attrs %}
          {% include 'partials/_button.html' with type='button' label='Abbrechen' variant='secondary' classes='px-2 py-1 rounded' attrs=cancel_attrs %}
        {% endwith %}
      </div>
    </form>
  {% endwith %}
{% else %}
  <div class="prose dark:prose-invert max-w-none">{{ text|markdownify }}</div>
  {% url 'hx_anlage1_note' anlage.pk num field as edit_url %}
  {% with num|stringformat:"s" as num_str %}
    {% with 'hx-get="'|add:edit_url|add:'?edit=1"'|add:' hx-target="#note-'|add:field|add:'-'|add:num_str|add:'"'|add:' hx-swap="outerHTML"' as edit_attrs %}
      {% include 'partials/_button.html' with type='button' label='Bearbeiten' variant='secondary' classes='mt-1 px-2 py-1 rounded' attrs=edit_attrs %}
    {% endwith %}
  {% endwith %}
{% endif %}
</div>
