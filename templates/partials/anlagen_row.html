{% load recording_extras %}
{% if form %}
<tr>
    <td colspan="{% if show_nr %}7{% else %}6{% endif %}">
        <form hx-post="{% url 'hx_project_file_upload' projekt.pk %}" hx-target="closest tr" hx-swap="outerHTML" hx-encoding="multipart/form-data" enctype="multipart/form-data" method="post">
            {% csrf_token %}
            <input type="hidden" name="anlage_nr" value="{{ form.anlage_nr }}">
            {{ form.non_field_errors }}
            {{ form.upload }} {{ form.upload.errors }}
            {% if form.parser_mode %}
            <div class="mt-2">
                {{ form.parser_mode.label_tag }} {{ form.parser_mode }}
                {{ form.parser_mode.errors }}
            </div>
            <div class="mt-2">
                {{ form.parser_order.label_tag }} {{ form.parser_order }}
                {{ form.parser_order.errors }}
            </div>
            {% endif %}
            <button type="submit" class="bg-blue-600 text-white px-2 py-1 rounded mt-2">Speichern</button>
        </form>
    </td>
</tr>
{% else %}
<tr class="border-t">
    {% if show_nr %}<td class="px-2 py-1">{{ anlage.anlage_nr }}</td>{% endif %}
    <td class="px-2 py-1"><a href="{{ anlage.upload.url }}" class="text-blue-700 underline">{{ anlage.upload.name|clean_filename }}</a></td>
    <td class="px-2 py-1">{{ anlage.version }}</td>
    <td class="px-2 py-1 text-center" id="anlage-edit-{{ anlage.pk }}">
        {% include 'partials/anlage_status.html' with anlage=anlage %}
    </td>
    <td class="px-2 py-1 text-center">
        {% if anlage.parent %}
            <a href="{% url 'compare_versions' anlage.pk %}" class="table-action-btn table-action-primary">Mit Vorgänger vergleichen</a>
        {% endif %}
    </td>
    <td class="px-2 py-1 text-center">
        <form method="post" action="{% url 'project_file_toggle_flag' anlage.pk 'manual_reviewed' %}">
            {% csrf_token %}
            <input type="hidden" name="value" value="{{ anlage.manual_reviewed|yesno:'0,1' }}">
            <button class="status-toggle-btn" title="Geprüft umschalten">
                {% if anlage.manual_reviewed %}
                <i class="fas fa-check text-green-600"></i>
                {% else %}
                <i class="fas fa-times text-gray-400"></i>
                {% endif %}
            </button>
        </form>
    </td>
    <td class="px-2 py-1 text-center">
        <form method="post" action="{% url 'project_file_toggle_flag' anlage.pk 'verhandlungsfaehig' %}">
            {% csrf_token %}
            <input type="hidden" name="value" value="{{ anlage.verhandlungsfaehig|yesno:'0,1' }}">
            <button class="status-toggle-btn" title="Verhandlungsfähigkeit umschalten">
                {% if anlage.verhandlungsfaehig %}
                <i class="fas fa-check text-green-600"></i>
                {% else %}
                <i class="fas fa-times text-gray-400"></i>
                {% endif %}
            </button>
        </form>
    </td>
</tr>
{% endif %}
