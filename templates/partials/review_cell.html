{% load recording_extras %}
<td class="border px-2 text-center">
    {% if row.result_id %}

    {% with doc_val=row.doc_result|get_item:field_name ai_val=row.ai_result|get_item:field_name manual_val=row.manual_result|get_item:field_name %}
    <button class="tri-state-icon rounded-full px-2 py-1 text-sm{% if field_name == 'technisch_vorhanden' and row.sub %} opacity-50 pointer-events-none{% endif %}
        {% if manual_val != '' and manual_val != doc_val %}
            bg-yellow-100 text-yellow-800
        {% elif manual_val == '' and doc_val != '' and ai_val != '' and doc_val != ai_val %}
            bg-yellow-100 text-yellow-800
        {% elif state is True %}
            bg-green-100 text-green-800
        {% elif state is False %}
            bg-red-100 text-red-800
        {% else %}
            bg-yellow-100 text-yellow-800
        {% endif %}"
            data-field-name="{{ field_name }}"
            data-is-manual="{{ is_manual|yesno:'true,false' }}"
            hx-post="{% url 'hx_update_review_cell' result_id=row.result_id field_name=field_name %}{% if row.sub_id %}?sub_id={{ row.sub_id }}{% endif %}"
            hx-target="closest tr" hx-swap="outerHTML">
        {% if state is True %}
        ✓ Vorhanden
        {% elif state is False %}
        ✗ Nicht vorhanden
        {% else %}
        ! Konflikt
        {% endif %}
    </button>
    {% endwith %}
    <span class="source-icon" data-popover-content="{{ source }}">
        {% if source == 'Manuell' %}
        <i class="fas fa-user"></i>
        {% elif source == 'KI-Check' %}
        <i class="fas fa-robot"></i>
        {% else %}
        <i class="fas fa-file-alt"></i>
        {% endif %}
    </span>
    {% if field_name == 'ki_beteiligung' and row.ki_beteiligt_begruendung %}

    <a href="{% url 'ki_involvement_detail_edit' anlage.pk row.verif_key %}" class="info-icon" data-popover-content="Begründung ansehen/bearbeiten">ℹ️</a>

    {% endif %}
    {% else %}
    <span>-</span>
    {% endif %}
    {{ widget }}
</td>
