{% load recording_extras %}
<td class="border px-2 text-center {% if state is True %}bg-green-500 text-white{% elif state is False %}bg-red-500 text-white{% else %}bg-yellow-500 text-black{% endif %}">
    {% if row.result_id %}

    {% with doc_val=row.doc_result|get_item:field_name ai_val=row.ai_result|get_item:field_name manual_val=row.manual_result|get_item:field_name %}
    <button class="tri-state-icon{% if field_name == 'technisch_vorhanden' and row.sub %} disabled-field{% endif %} {% if manual_val != '' and manual_val != doc_val %}bg-yellow-100 text-yellow-800{% elif manual_val == '' and doc_val != '' and ai_val != '' and doc_val != ai_val %}bg-yellow-100 text-yellow-800{% else %}{{ state|yesno:'bg-green-100 text-green-800,bg-red-100 text-red-800,' }}{% endif %}"

            data-field-name="{{ field_name }}"
            data-is-manual="{{ is_manual|yesno:'true,false' }}"
            hx-post="{% url 'hx_update_review_cell' result_id=row.result_id field_name=field_name %}{% if row.sub_id %}?sub_id={{ row.sub_id }}{% endif %}"
            hx-target="closest tr" hx-swap="outerHTML">
        {% if state is True %}
        ✓ Vorhanden
        {% elif state is False %}
        ✗ Nicht vorhanden
        {% else %}
        ! Konflikt
        {% endif %}
    </button>
    {% endwith %}
    <span class="source-icon" title="{{ source }}">
        {% if source == 'Manuell' %}
        <i class="fas fa-user"></i>
        {% elif source == 'KI-Check' %}
        <i class="fas fa-robot"></i>
        {% else %}
        <i class="fas fa-file-alt"></i>
        {% endif %}
    </span>
    {% if field_name == 'ki_beteiligung' and row.ki_beteiligt_begruendung %}
    <a href="{% url 'ki_involvement_detail_edit' anlage.pk row.verif_key %}" class="info-icon" title="Begründung ansehen/bearbeiten">ℹ️</a>
    {% endif %}
    {% else %}
    <span>-</span>
    {% endif %}
    {{ widget }}
</td>
