<div class="flex flex-col h-full">
    <!-- Oberer Abschnitt mit Konto- und Login/Logout-Links -->
    <div class="border-b border-gray-200 dark:border-gray-700 p-4">
        <ul class="space-y-2">
            <li>
                <a href="{% url 'account' %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light">
                    Mein Konto
                </a>
            </li>
            <li>
                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light">Abmelden</a>
                {% else %}
                <a href="{% url 'login' %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light">Anmelden</a>
                {% endif %}
            </li>
        </ul>
    </div>

    <!-- Hauptnavigation -->
    <nav class="flex-1 overflow-y-auto p-4">
        {% if admin_navigation|length == 0 and user_navigation|length == 1 %}
        <ul class="space-y-2">
            {% for tile in user_navigation.0.tiles %}
            <li>
                <a href="{% url tile.url_name %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light {% if request.resolver_match.url_name == tile.url_name %}active-nav-link{% endif %}">
                    {{ tile.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        {% for section in user_navigation %}
        <div class="mb-2">
            <button class="sidebar-accordion-btn" data-accordion-target="nav-u{{ forloop.counter }}">
                <span>{{ section.area.name }}</span>
                <i class="fa-solid fa-chevron-down transition-transform"></i>
            </button>
            <ul id="nav-u{{ forloop.counter }}" class="mt-1 pl-2 space-y-1 hidden">
                {% for tile in section.tiles %}
                <li>
                    <a href="{% url tile.url_name %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light {% if request.resolver_match.url_name == tile.url_name %}active-nav-link{% endif %}">
                        {{ tile.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
        {% for section in admin_navigation %}
        <div class="mb-2">
            <button class="sidebar-accordion-btn" data-accordion-target="nav-a{{ forloop.counter }}">
                <span>{{ section.name }}</span>
                <i class="fa-solid fa-chevron-down transition-transform"></i>
            </button>
            {% if section.tiles %}
            <ul id="nav-a{{ forloop.counter }}" class="mt-1 pl-2 space-y-1 hidden">
                {% for tile in section.tiles %}
                <li>
                    <a href="{% url tile.url_name %}" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light {% if request.resolver_match.url_name == tile.url_name %}active-nav-link{% endif %}">
                        {{ tile.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            {% with counter=forloop.counter|stringformat:"s" %}
            {% with section_prefix='nav-a'|add:counter|add:'-' %}
            <div id="nav-a{{ forloop.counter }}" class="mt-1 pl-2 space-y-1 hidden">
                {% include 'partials/_sidebar_group.html' with groups=section.groups prefix=section_prefix %}
            </div>
            {% endwith %}
            {% endwith %}
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
    </nav>

    <!-- Unterer Bereich mit Zurück-Link und Theme-Schalter -->
    <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700">
        <a href="javascript:history.back()" class="block px-4 py-2 rounded hover:bg-accent hover:text-text-light">Zurück</a>
        <button id="theme-toggle" class="mt-2 w-full flex items-center px-4 py-2 rounded hover:bg-accent hover:text-text-light">
            <i class="fa-solid fa-sun mr-2"></i>
            Theme wechseln
        </button>
    </div>
</div>
