{% load recording_extras %}
<div class="space-y-4">
    {% for row in knowledge_rows %}
        <div class="card p-4">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h3 class="font-semibold">{{ row.name }}</h3>
                    <div>
                        {% if row.entry and row.entry.gutachten %}
                            {% include 'partials/status_badge.html' with status_key='ja' label='✓ Gutachten vorhanden' %}
                        {% else %}
                            {% include 'partials/status_badge.html' with status_key='nein' label='✗ Kein Gutachten' %}
                        {% endif %}
                    </div>
                </div>
                <div class="space-x-2">
                    {% if row.entry %}
                        {% if row.entry.gutachten %}
                            <a href="{% url 'gutachten_edit' row.entry.gutachten.id %}" class="btn-action">Bearbeiten</a>
                            <a href="{% url 'gutachten_download' row.entry.gutachten.id %}" class="btn-action">Download</a>
                        {% else %}
                            <button class="btn btn-sm btn-primary generate-gutachten-btn" data-knowledge-id="{{ row.entry.id }}">Gutachten erstellen</button>
                        {% endif %}
                        <span class="gutachten-status-spinner ms-2" id="gutachten-status-{{ row.entry.id }}"></span>
                    {% endif %}
                </div>
            </div>
            <div>
                {% if row.entry and row.entry.gutachten %}
                    <div class="prose dark:prose-invert max-w-none">
                        {{ row.entry.gutachten.text|markdownify }}
                    </div>
                {% elif row.entry %}
                    <span class="text-sm text-gray-500 dark:text-gray-400">Noch kein Gutachten vorhanden</span>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>

