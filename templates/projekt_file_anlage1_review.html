{% extends 'base.html' %}
{% load recording_extras %}
{% block title %}Anlage 1 Review{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Anlage 1 Fragen prüfen</h1>
<div class="mb-6">
  <h2 class="text-xl font-semibold mb-2">GAP‑Bericht (Anlage 1)</h2>
  <form method="post" class="space-y-2">
    {% csrf_token %}
    {% include 'partials/markdown_editor.html' with id_prefix='gap1' text=gap_text name='gap_summary' label='GAP-Bericht für Fachbereich' %}
  </form>
  <p class="text-sm text-gray-500">Tipp: Der Text wird vorgeschlagen und kann hier projektspezifisch angepasst und gespeichert werden.</p>
  <hr class="my-4">
</div>
<div class="space-y-4">
    {% for q in qa %}
    <div class="p-4 border rounded space-y-2">
        <div class="font-semibold">{{ q.num }}. {{ q.question }}</div>
        <div class="prose dark:prose-invert max-w-none">{{ q.answer|markdownify }}</div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <h3 class="text-sm font-semibold">Interne Arbeitsanmerkung</h3>
                {% include 'partials/anlage1_note.html' with anlage=anlage num=q.num field='hinweis' text=q.hinweis editing=False %}
            </div>
            <div>
                <h3 class="text-sm font-semibold">(Extern) Anmerkungen</h3>
                {% include 'partials/anlage1_note.html' with anlage=anlage num=q.num field='vorschlag' text=q.vorschlag editing=False %}
            </div>
            <div class="flex flex-col">
                <h3 class="text-sm font-semibold mb-1">Verhandlungsfähig</h3>
                {% include 'partials/anlage1_negotiable.html' with anlage=anlage num=q.num is_ok=q.ok %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<p class="mb-2">Hinweis: Externe Anmerkungen und unklare/fehlende Antworten fließen automatisch in den GAP‑Bericht ein.</p>
{% endblock %}
{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    initMarkdownEditor('gap1');
  });
  document.body.addEventListener('htmx:afterSettle', function() {
    // Falls der Inhalt via HTMX neu geladen wurde
    initMarkdownEditor('gap1');
  });
  
</script>
{% endblock %}
