{% extends 'base.html' %}
{% block title %}Pr\u00fcfergebnis{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Pr\u00fcfergebnis f\u00fcr Anlage {{ anlage.anlage_nr }}</h1>
<form method="get" class="mb-4">
    <label class="font-semibold">LLM-Modell:</label>
    {% for key, data in categories.items %}
        <label class="ml-2">
            {% include 'partials/_form_input.html' with type='radio' name='model_category' value=key checked=(key == category) base_classes='mr-1' %}
            {{ data.label }}
        </label>
    {% endfor %}
    {% include 'partials/_button.html' with type='submit' label='Neu prüfen' variant='primary' classes='px-4 py-2 rounded ml-2' %}
    {% if anlage.anlage_nr == 2 %}
    {% include 'partials/_button.html' with type='submit' name='llm' value='1' label='LLM-Check' variant='purple' classes='px-4 py-2 rounded ml-2' %}
    {% endif %}
</form>
<form method="post" class="space-y-4">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {% if form.analysis_json %}
    <div>
        {{ form.analysis_json.label_tag }}<br>
        {{ form.analysis_json }}
        {{ form.analysis_json.errors }}
    </div>
    {% endif %}
    {% if form.manual_analysis_json %}
    <div>
        {{ form.manual_analysis_json.label_tag }}<br>
        {{ form.manual_analysis_json }}
        {{ form.manual_analysis_json.errors }}
    </div>
    {% endif %}
    <div class="space-x-2">
        {% include 'partials/_button.html' with type='submit' label='Speichern' variant='primary' classes='px-4 py-2 rounded' %}
        {% url 'projekt_detail' anlage.project.pk as detail_url %}
        {% include 'partials/_button.html' with href=detail_url label='Zurück' variant='secondary' classes='px-4 py-2 rounded' %}
        {% include 'partials/_button.html' with type='button' id='copy-email' label='E-Mail kopieren' variant='success' classes='px-4 py-2 rounded' %}
    </div>
</form>
<script>
document.getElementById('copy-email').addEventListener('click', function(){
    const analysis = document.getElementById('{{ form.analysis_json.id_for_label }}').value;
    const manual = document.getElementById('{{ form.manual_analysis_json.id_for_label }}').value;
    const text = `Pr\u00fcfergebnis Anlage {{ anlage.anlage_nr }}\n\nAnalyse:\n${analysis}\n\nManuelle Analyse:\n${manual}`;
    navigator.clipboard.writeText(text).then(()=>alert('In Zwischenablage kopiert'));
});
</script>
{% endblock %}
